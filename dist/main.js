!function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e,n){var o,r,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t,n){i._validInput(e)?(t.classList.add(n),t.setAttribute("disabled","")):(t.classList.remove(n),t.removeAttribute("disabled"))},(o="_toggleButton")in this?Object.defineProperty(this,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[o]=r,this._settings=e,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonSelector=e.inactiveButtonSelector,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=n}var n,o;return n=t,(o=[{key:"_showInputError",value:function(e,t){var n=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),n.textContent=t,n.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){var t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_validInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"_setEventListeners",value:function(){var e=this,t=Array.from(this._formElement.querySelectorAll(this._inputSelector)),n=this._formElement.querySelector(this._submitButtonSelector);t.forEach((function(o){o.addEventListener("input",(function(){e._checkInputValidity(o),e._toggleButton(t,n,e._inactiveButtonSelector)}))}))}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}])&&e(n.prototype,o),t}();function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=document.querySelector(".popup_type_image"),r=document.querySelector(".popup__caption"),i=document.querySelector(".popup__image"),u=function(e){console.log("handleEsc ran"),"Escape"===e.key&&(document.querySelector(".popup_opened"),o.classList.remove("popup_opened"),document.removeEventListener("keyup",u))};var c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t.name,this._link=t.link,this._cardSelector=n}var t,c;return t=e,(c=[{key:"_getCardTemplate",value:function(){return this._cardSelector.cloneNode(!0)}},{key:"_setEventListeners",value:function(e){var t=this,n=e.querySelector(".element__button"),c=e.querySelector(".element__trash"),a=e.querySelector(".element__image");n.addEventListener("click",(function(){n.classList.toggle("element__button_active")})),c.addEventListener("click",(function(){e.remove()})),a.addEventListener("click",(function(){r.textContent=t._name,i.src=t._link,i.setAttribute("alt",r.textContent),o.classList.add("popup_opened"),document.addEventListener("keyup",u)}))}},{key:"getView",value:function(){return this._card=this._getCardTemplate(),this._card.querySelector(".element__image").style.backgroundImage="url(".concat(this._link,")"),this._card.querySelector(".element__title").textContent=this._name,this._setEventListeners(this._card),this._card}}])&&n(t.prototype,c),e}(),a=(document.querySelector(".popup__form_type_edit"),document.querySelector(".popup__form_type_add"),document.querySelector(".popup__content"),document.querySelector(".profile__button")),l=(document.querySelector(".popup__button_type_edit"),document.querySelector(".popup__button_type_add"),document.querySelector(".profile__add-button")),s=document.querySelector(".profile__title"),p=document.querySelector(".profile__subtitle"),_=document.querySelector(".popup_type_edit"),d=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),y=document.querySelector(".popup__image"),v=(document.querySelector(".popup__caption"),document.querySelector(".template__photo"),document.querySelector(".template__photo").content.querySelector(".element__item")),f={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonSelector:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},h=new t(f,_),S=new t(f,d);h.enableValidation(),S.enableValidation();var b=_.querySelector(".popup__close"),E=d.querySelector(".popup__close"),k=m.querySelector(".popup__close"),q=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),g=(document.querySelector(".element__button_active"),document.querySelector(".element__title"),document.querySelector(".element__image"),document.querySelector(".element"));function C(e,t){var n=new c(e,t);g.prepend(n.getView())}[{name:"Yosemite Valley",link:"https://code.s3.yandex.net/web-code/yosemite.jpg"},{name:"Lake Louise",link:"https://code.s3.yandex.net/web-code/lake-louise.jpg"},{name:"Bald Mountains",link:"https://code.s3.yandex.net/web-code/bald-mountains.jpg"},{name:"Latemar",link:"https://code.s3.yandex.net/web-code/latemar.jpg"},{name:"Vanoise National Park",link:"https://code.s3.yandex.net/web-code/vanoise.jpg"},{name:"Lago di Braies",link:"https://code.s3.yandex.net/web-code/lago.jpg"}].forEach((function(e){C(e,v)}));var w=function(e){console.log("handleEsc ran"),"Escape"===e.key&&j(document.querySelector(".popup_opened"))};function x(e){e.target.classList.contains("popup_opened")&&j(document.querySelector(".popup_opened"))}function B(e){e.classList.add("popup_opened"),document.addEventListener("keyup",w)}function j(e){e.classList.remove("popup_opened"),document.removeEventListener("keyup",w)}y.addEventListener("click",(function(){B(m)})),a.addEventListener("click",(function(){q.value=s.textContent,L.value=p.textContent,B(_)})),b.addEventListener("click",(function(){j(_)})),_.addEventListener("submit",(function(e){e.preventDefault(),s.textContent=q.value,p.textContent=L.value,j(_)})),l.addEventListener("click",(function(){B(d)})),E.addEventListener("click",(function(){j(d)})),d.addEventListener("submit",(function(e){e.preventDefault();var t=d.querySelector(".popup__input_type_card-name"),n=d.querySelector(".popup__input_type_url");C({name:t.value,link:n.value},v),j(d)})),k.addEventListener("click",(function(){j(m)})),_.addEventListener("click",x),d.addEventListener("click",x),m.addEventListener("click",x)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVVHLE9BQU8sZ0JBQ3ZCd0MsU0FBU08sb0JBQW9CLFFBQVNKLEdBSTFDNkIsRUFBYXZDLGlCQUFpQixTQUFTLFdBQ25DNkQsRUFBVXBELE1BR2R3QixFQUFjakMsaUJBQWlCLFNBQVMsV0FDcENpRCxFQUFVYyxNQUFRNUIsRUFBYWpELFlBQy9CZ0UsRUFBU2EsTUFBUTNCLEVBQWdCbEQsWUFDakMyRSxFQUFVeEIsTUFJZFMsRUFBZ0I5QyxpQkFBaUIsU0FBUyxXQUN0Q3dELEVBQVduQixNQUdmQSxFQUFVckMsaUJBQWlCLFVBcEMzQixTQUE4QkcsR0FDMUJBLEVBQUlDLGlCQUNKK0IsRUFBYWpELFlBQWMrRCxFQUFVYyxNQUNyQzNCLEVBQWdCbEQsWUFBY2dFLEVBQVNhLE1BQ3ZDUCxFQUFXbkIsTUFrQ2ZILEVBQVVsQyxpQkFBaUIsU0FBUyxXQUNoQzZELEVBQVV2QixNQUdkUyxFQUFtQi9DLGlCQUFpQixTQUFTLFdBQ3pDd0QsRUFBV2xCLE1BR2ZBLEVBQWF0QyxpQkFBaUIsVUEzRTlCLFNBQWlCRyxHQUNiQSxFQUFJQyxpQkFDSixJQUFNNEQsRUFBYTFCLEVBQWF0RCxjQUFjLGdDQUN4Q2lGLEVBQWEzQixFQUFhdEQsY0FBYywwQkFFOUNvRSxFQUFXLENBQUVqQyxLQUFNNkMsRUFBV0QsTUFBTzFDLEtBQU00QyxFQUFXRixPQUFTdkIsR0FDL0RnQixFQUFXbEIsTUF1RWZVLEVBQWlCaEQsaUJBQWlCLFNBQVMsV0FDdkN3RCxFQUFXL0MsTUFJZjRCLEVBQVVyQyxpQkFBaUIsUUFBU3lELEdBQ3BDbkIsRUFBYXRDLGlCQUFpQixRQUFTeUQsR0FDdkNoRCxFQUFXVCxpQkFBaUIsUUFBU3lELEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95YW5kZXgucHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly95YW5kZXgucHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly95YW5kZXgucHJhY3RpY3VtLy4vc3JjL3BhZ2VzL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICAgIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtRWxlbWVudCkge1xuICAgICAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcbiAgICAgICAgdGhpcy5faW5hY3RpdmVCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uU2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcbiAgICAgICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XG5cbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcbiAgICB9XG5cbiAgICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICAgIH07XG5cbiAgICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgfTtcblxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XG4gICAgICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIF92YWxpZElucHV0KGlucHV0cykge1xuICAgICAgICByZXR1cm4gaW5wdXRzLnNvbWUoKGlucHV0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gIWlucHV0LnZhbGlkaXR5LnZhbGlkO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgX3RvZ2dsZUJ1dHRvbiA9IChpbnB1dHMsIGJ1dHRvbiwgX2luYWN0aXZlQnV0dG9uU2VsZWN0b3IpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuX3ZhbGlkSW5wdXQoaW5wdXRzKSkge1xuICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoX2luYWN0aXZlQnV0dG9uU2VsZWN0b3IpO1xuICAgICAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoX2luYWN0aXZlQnV0dG9uU2VsZWN0b3IpO1xuICAgICAgICAgICAgYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcbiAgICAgICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gICAgICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvbihpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHRoaXMuX2luYWN0aXZlQnV0dG9uU2VsZWN0b3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yOyIsImNvbnN0IGltYWdlUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9pbWFnZScpO1xuY29uc3QgcG9wdXBDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2FwdGlvblwiKTtcbmNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZVwiKTtcblxuXG5jb25zdCBoYW5kbGVFc2MgPSAoZXZ0KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2hhbmRsZUVzYyByYW4nKVxuICAgIGlmIChldnQua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICAvLyBmaW5kIG9wZW4gcG9wdXBcbiAgICAgICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX29wZW5lZFwiKTtcbiAgICAgICAgY2xvc2VJbWFnZVBvcHVwKG9wZW5lZFBvcHVwKTtcbiAgICB9XG59O1xuXG5mdW5jdGlvbiBvcGVuSW1hZ2VQb3B1cCgpIHtcbiAgICBpbWFnZVBvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBoYW5kbGVFc2MpO1xufVxuXG5mdW5jdGlvbiBjbG9zZUltYWdlUG9wdXAoKSB7XG4gICAgaW1hZ2VQb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBoYW5kbGVFc2MpO1xufVxuXG5jbGFzcyBDYXJkIHtcbiAgICBjb25zdHJ1Y3RvcihjYXJkLCBjYXJkU2VsZWN0b3IpIHtcbiAgICAgICAgdGhpcy5fbmFtZSA9IGNhcmQubmFtZTtcbiAgICAgICAgdGhpcy5fbGluayA9IGNhcmQubGluaztcbiAgICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIH1cblxuICAgIF9nZXRDYXJkVGVtcGxhdGUoKSB7XG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gdGhpcy5fY2FyZFNlbGVjdG9yLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgcmV0dXJuIGNhcmRFbGVtZW50O1xuICAgICAgICAvL2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgfVxuXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKF9jYXJkKSB7XG4gICAgICAgIGNvbnN0IGxpa2VCdXR0b24gPSBfY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2J1dHRvblwiKTtcbiAgICAgICAgY29uc3QgZGVsZXRlQnV0dG9uID0gX2NhcmQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X190cmFzaFwiKTtcbiAgICAgICAgY29uc3QgY2FyZEltYWdlID0gX2NhcmQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19pbWFnZVwiKTtcblxuXG4gICAgICAgIGxpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImVsZW1lbnRfX2J1dHRvbl9hY3RpdmVcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgX2NhcmQucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgcG9wdXBDYXB0aW9uLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICAgICAgICAgIHBvcHVwSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICAgICAgICAgIHBvcHVwSW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHBvcHVwQ2FwdGlvbi50ZXh0Q29udGVudCk7XG4gICAgICAgICAgICBvcGVuSW1hZ2VQb3B1cCgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRWaWV3KCkge1xuICAgICAgICB0aGlzLl9jYXJkID0gdGhpcy5fZ2V0Q2FyZFRlbXBsYXRlKCk7XG5cbiAgICAgICAgdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2ltYWdlXCIpLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoJHt0aGlzLl9saW5rfSlgO1xuICAgICAgICB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuXG4gICAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKHRoaXMuX2NhcmQpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLl9jYXJkO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2FyZDsiLCJpbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5cbi8vID09PT09IFxuLy8gV3JhcHBlcnMgXG4vLyA9PT09PSBcbmNvbnN0IGVkaXRGb3JtRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1fdHlwZV9lZGl0XCIpO1xuY29uc3QgYWRkRm9ybUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX3R5cGVfYWRkXCIpO1xuY29uc3QgZm9ybUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jb250ZW50XCIpO1xuXG5cblxuLy8gPT09PT0gXG4vL0J1dHRvbnMgJiBET00gZWxlbWVudHMgXG4vLyA9PT09PSBcbmNvbnN0IHByb2ZpbGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvblwiKTtcbmNvbnN0IHBvcHVwRWRpdFNhdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idXR0b25fdHlwZV9lZGl0XCIpO1xuY29uc3QgcG9wdXBBZGRTYXZlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uX3R5cGVfYWRkXCIpO1xuY29uc3QgYWRkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuY29uc3QgcHJvZmlsZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190aXRsZVwiKTtcbmNvbnN0IHByb2ZpbGVTdWJ0aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fc3VidGl0bGVcIik7XG5cblxuLy8gPT09PT0gXG4vL0RpZmZlcmVudCBwb3B1cHMgXG4vLyA9PT09PSBcbmNvbnN0IHBvcHVwRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9lZGl0XCIpO1xuY29uc3QgcG9wdXBOZXdDYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX25ldy1jYXJkXCIpO1xuY29uc3QgcG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9pbWFnZVwiKTtcblxuLy9jb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBcIik7XG5cbmNvbnN0IHBvcHVwUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlXCIpO1xuY29uc3QgcG9wdXBDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2FwdGlvblwiKTtcblxuXG5jb25zdCBjYXJkU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRlbXBsYXRlX19waG90b1wiKTtcbi8vJyN0ZW1wbGF0ZV9fcGhvdG8nO1xuXG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVtcGxhdGVfX3Bob3RvXCIpLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19pdGVtXCIpO1xuXG4vLyA9PT09XG4vL1ZhbGlkYXRpb25cbi8vID09PT1cbmNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxuICAgIGluYWN0aXZlQnV0dG9uU2VsZWN0b3I6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICAgIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAgIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmNvbnN0IHBvcHVwRWRpdFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHZhbGlkYXRpb25TZXR0aW5ncywgcG9wdXBFZGl0KTtcbmNvbnN0IHBvcHVwTmV3Q2FyZFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHZhbGlkYXRpb25TZXR0aW5ncywgcG9wdXBOZXdDYXJkKTtcblxucG9wdXBFZGl0VmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbnBvcHVwTmV3Q2FyZFZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbi8vID09PT09IFxuLy9DbG9zZSBidXR0b25zIGZvciBkaWZmZXJlbnQgcG9wdXBzIFxuLy8gPT09PT0gXG5jb25zdCBjbG9zZUVkaXRCdXR0b24gPSBwb3B1cEVkaXQucXVlcnlTZWxlY3RvcignLnBvcHVwX19jbG9zZScpO1xuY29uc3QgY2xvc2VOZXdDYXJkQnV0dG9uID0gcG9wdXBOZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UnKTtcbmNvbnN0IGNsb3NlSW1hZ2VCdXR0b24gPSBwb3B1cEltYWdlLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UnKTtcblxuXG5cbi8vID09PT09IFxuLy8gRm9ybSBkYXRhIFxuLy8gPT09PT0gXG5jb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF90eXBlX25hbWVcIik7XG5jb25zdCBqb2JJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X3R5cGVfZGVzY3JpcHRpb25cIik7XG5cblxuXG5cbi8vID09PT09IFxuLy8gRWxlbWVudCBpdGVtcyBcbi8vID09PT09IFxuXG5jb25zdCBsaWtlQnV0dG9uQWN0aXZlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19idXR0b25fYWN0aXZlXCIpO1xuY29uc3QgZWxlbWVudFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X190aXRsZVwiKTtcbmNvbnN0IGVsZW1lbnRJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XG5jb25zdCBlbGVtZW50TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudFwiKTtcblxuY29uc3QgaW5pdGlhbENhcmRzID0gW3tcbiAgICAgICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS95b3NlbWl0ZS5qcGdcIlxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFrZS1sb3Vpc2UuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2JhbGQtbW91bnRhaW5zLmpwZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgICAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhdGVtYXIuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS92YW5vaXNlLmpwZ1wiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICAgICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWdvLmpwZ1wiXG4gICAgfVxuXTtcblxuZnVuY3Rpb24gcmVuZGVyQ2FyZChkYXRhLCBjYXJkU2VsZWN0b3IpIHtcbiAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoZGF0YSwgY2FyZFNlbGVjdG9yKVxuICAgIGVsZW1lbnRMaXN0LnByZXBlbmQoY2FyZC5nZXRWaWV3KCkpO1xufTtcblxuLy9yZW5kZXIgZmlyc3QgNiBjYXJkc1xuaW5pdGlhbENhcmRzLmZvckVhY2goKGNhcmQpID0+IHtcbiAgICByZW5kZXJDYXJkKGNhcmQsIGNhcmRUZW1wbGF0ZSlcbn0pO1xuXG4vL2NyZWF0ZSBuZXcgY2FyZHNcbmZ1bmN0aW9uIGFkZENhcmQoZXZ0KSB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgdGl0bGVJbnB1dCA9IHBvcHVwTmV3Q2FyZC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF90eXBlX2NhcmQtbmFtZVwiKTtcbiAgICBjb25zdCBpbWFnZUlucHV0ID0gcG9wdXBOZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X3R5cGVfdXJsXCIpO1xuXG4gICAgcmVuZGVyQ2FyZCh7IG5hbWU6IHRpdGxlSW5wdXQudmFsdWUsIGxpbms6IGltYWdlSW5wdXQudmFsdWUgfSwgY2FyZFRlbXBsYXRlKTtcbiAgICBjbG9zZVBvcHVwKHBvcHVwTmV3Q2FyZCk7XG59O1xuXG4vL0Nsb3NlIFBvcHVwXG5cbmNvbnN0IGhhbmRsZUVzYyA9IChldnQpID0+IHtcbiAgICBjb25zb2xlLmxvZygnaGFuZGxlRXNjIHJhbicpXG4gICAgaWYgKGV2dC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgIC8vIGZpbmQgb3BlbiBwb3B1cFxuICAgICAgICBjb25zdCBvcGVuZWRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfb3BlbmVkXCIpO1xuICAgICAgICBjbG9zZVBvcHVwKG9wZW5lZFBvcHVwKTtcbiAgICB9XG59O1xuXG5mdW5jdGlvbiBoYW5kbGVPdmVybGF5Q2xpY2soZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuZWRcIikpIHtcbiAgICAgICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX29wZW5lZFwiKTtcbiAgICAgICAgY2xvc2VQb3B1cChvcGVuZWRQb3B1cCk7XG4gICAgfVxufVxuLy8gPT09PT0gXG4vLyBIYW5kbGVycyBcbi8vID09PT09IFxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XG4gICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgcHJvZmlsZVRpdGxlLnRleHRDb250ZW50ID0gbmFtZUlucHV0LnZhbHVlO1xuICAgIHByb2ZpbGVTdWJ0aXRsZS50ZXh0Q29udGVudCA9IGpvYklucHV0LnZhbHVlO1xuICAgIGNsb3NlUG9wdXAocG9wdXBFZGl0KTtcbn1cblxuLy8gPT09PT0gXG4vLyBFdmVudCBsaXN0ZW5lcnMgXG4vLyA9PT09PSBcbmZ1bmN0aW9uIG9wZW5Qb3B1cChwb3B1cCkge1xuICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBoYW5kbGVFc2MpO1xufVxuXG5mdW5jdGlvbiBjbG9zZVBvcHVwKHBvcHVwKSB7XG4gICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgaGFuZGxlRXNjKTtcbn1cblxuXG5wb3B1cFBpY3R1cmUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgb3BlblBvcHVwKHBvcHVwSW1hZ2UpO1xufSlcblxucHJvZmlsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIG5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVUaXRsZS50ZXh0Q29udGVudDtcbiAgICBqb2JJbnB1dC52YWx1ZSA9IHByb2ZpbGVTdWJ0aXRsZS50ZXh0Q29udGVudDtcbiAgICBvcGVuUG9wdXAocG9wdXBFZGl0KTtcblxufSk7XG5cbmNsb3NlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsb3NlUG9wdXAocG9wdXBFZGl0KTtcbn0pO1xuXG5wb3B1cEVkaXQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCk7XG5cbmFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIG9wZW5Qb3B1cChwb3B1cE5ld0NhcmQpO1xufSk7XG5cbmNsb3NlTmV3Q2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsb3NlUG9wdXAocG9wdXBOZXdDYXJkKTtcbn0pO1xuXG5wb3B1cE5ld0NhcmQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBhZGRDYXJkKTtcblxuY2xvc2VJbWFnZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsb3NlUG9wdXAocG9wdXBJbWFnZSk7XG59KTtcblxuLy8gT3ZlcmxheSBDbGlja1xucG9wdXBFZGl0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlT3ZlcmxheUNsaWNrKTtcbnBvcHVwTmV3Q2FyZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZU92ZXJsYXlDbGljayk7XG5wb3B1cEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlT3ZlcmxheUNsaWNrKTsiXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJpbnB1dHMiLCJidXR0b24iLCJfaW5hY3RpdmVCdXR0b25TZWxlY3RvciIsIl92YWxpZElucHV0IiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwicmVtb3ZlIiwicmVtb3ZlQXR0cmlidXRlIiwidGhpcyIsIl9zZXR0aW5ncyIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25TZWxlY3RvciIsIl9pbnB1dEVycm9yQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNvbWUiLCJpbnB1dCIsImlucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b25FbGVtZW50IiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwiX3RvZ2dsZUJ1dHRvbiIsImV2dCIsInByZXZlbnREZWZhdWx0IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiaW1hZ2VQb3B1cCIsImRvY3VtZW50IiwicG9wdXBDYXB0aW9uIiwicG9wdXBJbWFnZSIsImhhbmRsZUVzYyIsImNvbnNvbGUiLCJsb2ciLCJrZXkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiQ2FyZCIsImNhcmQiLCJjYXJkU2VsZWN0b3IiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfY2FyZFNlbGVjdG9yIiwiY2xvbmVOb2RlIiwiX2NhcmQiLCJsaWtlQnV0dG9uIiwiZGVsZXRlQnV0dG9uIiwiY2FyZEltYWdlIiwidG9nZ2xlIiwic3JjIiwiX2dldENhcmRUZW1wbGF0ZSIsInN0eWxlIiwiYmFja2dyb3VuZEltYWdlIiwicHJvZmlsZUJ1dHRvbiIsImFkZEJ1dHRvbiIsInByb2ZpbGVUaXRsZSIsInByb2ZpbGVTdWJ0aXRsZSIsInBvcHVwRWRpdCIsInBvcHVwTmV3Q2FyZCIsInBvcHVwUGljdHVyZSIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJ2YWxpZGF0aW9uU2V0dGluZ3MiLCJwb3B1cEVkaXRWYWxpZGF0b3IiLCJwb3B1cE5ld0NhcmRWYWxpZGF0b3IiLCJlbmFibGVWYWxpZGF0aW9uIiwiY2xvc2VFZGl0QnV0dG9uIiwiY2xvc2VOZXdDYXJkQnV0dG9uIiwiY2xvc2VJbWFnZUJ1dHRvbiIsIm5hbWVJbnB1dCIsImpvYklucHV0IiwiZWxlbWVudExpc3QiLCJyZW5kZXJDYXJkIiwiZGF0YSIsInByZXBlbmQiLCJnZXRWaWV3IiwiY2xvc2VQb3B1cCIsImhhbmRsZU92ZXJsYXlDbGljayIsImUiLCJ0YXJnZXQiLCJjb250YWlucyIsIm9wZW5Qb3B1cCIsInBvcHVwIiwidmFsdWUiLCJ0aXRsZUlucHV0IiwiaW1hZ2VJbnB1dCJdLCJzb3VyY2VSb290IjoiIn0=